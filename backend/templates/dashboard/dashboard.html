{% extends "base.html" %}
{% block title %}Dashboard - Toolbox{% endblock %}
{% block content %}

<div class="row mb-4">
  <div class="col-md-12">
    <h2>ğŸ  Dashboard Toolbox</h2>
    <p class="text-muted">Infrastructure prÃªte pour l'intÃ©gration de vos outils de cybersÃ©curitÃ©</p>
  </div>
</div>

<!-- Statistiques de base -->
<div class="row mb-4">
  <div class="col-md-4">
    <div class="card bg-primary text-white">
      <div class="card-body">
        <h5>{{ stats.get('tasks', {}).get('completed', 0) }}</h5>
        <small>TÃ¢ches terminÃ©es</small>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card bg-info text-white">
      <div class="card-body">
        <h5>{{ stats.get('tasks', {}).get('running', 0) }}</h5>
        <small>TÃ¢ches en cours</small>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card bg-warning text-white">
      <div class="card-body">
        <h5>{{ stats.get('active_users', 0) }}</h5>
        <small>Utilisateurs actifs</small>
      </div>
    </div>
  </div>
</div>

<!-- Zone d'intÃ©gration -->
<!-- Zone modules HuntKit -->
<div class="row mb-4">
  <div class="col-md-12">
    <h4>ğŸ”§ Modules HuntKit IntÃ©grÃ©s</h4>
  </div>
  
  {% if current_user and current_user.role in ['pentester', 'admin'] %}
  <div class="col-md-3">
    <div class="card border-primary h-100">
      <div class="card-body text-center">
        <h5 class="card-title">ğŸŒ DÃ©couverte</h5>
        <p class="card-text">Scan rÃ©seau avec Nmap</p>
        <a href="/huntkit/discovery" class="btn btn-primary btn-sm">Lancer</a>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card border-success h-100">
      <div class="card-body text-center">
        <h5 class="card-title">ğŸ•·ï¸ Audit Web</h5>
        <p class="card-text">Nikto + Nuclei + SQLMap</p>
        <a href="/huntkit/web-audit" class="btn btn-success btn-sm">Lancer</a>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card border-warning h-100">
      <div class="card-body text-center">
        <h5 class="card-title">ğŸ”¨ Force Brute</h5>
        <p class="card-text">Attaques Hydra</p>
        <a href="/huntkit/brute-force" class="btn btn-warning btn-sm">Lancer</a>
      </div>
    </div>
  </div>
  <div class="row mb-4">
  <div class="col-md-12">
    <h5 class="text-muted">ğŸª Framework Metasploit</h5>
  </div>
  
  <div class="col-md-4">
    <div class="card border-dark h-100" style="background: linear-gradient(135deg, #2c3e50, #34495e);">
      <div class="card-body text-center text-white">
        <h5 class="card-title">ğŸ¯ Exploitation</h5>
        <p class="card-text">Interface complÃ¨te Metasploit</p>
        <small class="d-block mb-2">Recherche â€¢ Configuration â€¢ Exploitation</small>
        <a href="/huntkit/exploit" class="btn btn-light btn-sm">
          <strong>ğŸš€ AccÃ©der</strong>
        </a>
      </div>
    </div>
  </div>
  
  <div class="col-md-4">
    <div class="card border-info h-100">
      <div class="card-body text-center">
        <h5 class="card-title">ğŸ” Recherche</h5>
        <p class="card-text">Base d'exploits Metasploit</p>
        <small class="d-block mb-2">2000+ exploits â€¢ CVE â€¢ Modules</small>
        <a href="/huntkit/exploit#search" class="btn btn-info btn-sm">Rechercher</a>
      </div>
    </div>
  </div>
  
  <div class="col-md-4">
    <div class="card border-secondary h-100">
      <div class="card-body text-center">
        <h5 class="card-title">ğŸ§ª Test Framework</h5>
        <p class="card-text">VÃ©rification installation</p>
        <small class="d-block mb-2">Tests â€¢ Version â€¢ Modules</small>
        <a href="/huntkit/exploit#test" class="btn btn-secondary btn-sm">Tester</a>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card border-danger h-100">
      <div class="card-body text-center">
        <h5 class="card-title">ğŸ¯ Pentest</h5>
        <p class="card-text">ChaÃ®ne complÃ¨te</p>
        <a href="/huntkit/full-pentest" class="btn btn-danger btn-sm">Lancer</a>
      </div>
    </div>
  </div>
  {% else %}
  <div class="col-md-12">
    <div class="alert alert-info">
      <strong>â„¹ï¸ Modules disponibles</strong><br>
      Les modules de pentest HuntKit sont disponibles pour les utilisateurs avec le rÃ´le <strong>pentester</strong> ou <strong>admin</strong>.
    </div>
  </div>
  {% endif %}
  
  <div class="col-md-12 mt-3">
    <div class="text-center">
      <a href="/huntkit/tools-status" class="btn btn-outline-info">ğŸ”§ VÃ©rifier statut des outils</a>
    </div>
  </div>
</div>


<!-- ActivitÃ© rÃ©cente -->
<div class="row">
  <div class="col-md-12">
    <div class="card">
      <div class="card-header">
        <h5>ğŸ“Š ActivitÃ© systÃ¨me</h5>
      </div>
      <div class="card-body">
        {% if recent_tasks and recent_tasks|length > 0 %}
          <div class="list-group">
            {% for task in recent_tasks %}
            <div class="list-group-item">
              <div class="d-flex w-100 justify-content-between">
                <h6 class="mb-1">{{ task.task_name or 'TÃ¢che systÃ¨me' }}</h6>
                <small>{{ task.started_at or 'Date inconnue' }}</small>
              </div>
              <p class="mb-1">{{ task.target or 'N/A' }}</p>
              <small class="badge bg-{{ 'success' if task.status == 'completed' else 'primary' if task.status == 'running' else 'danger' }}">
                {{ task.status or 'unknown' }}
              </small>
            </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="text-center text-muted py-4">
            ğŸ“­ Aucune activitÃ© rÃ©cente
            <br><small>Les tÃ¢ches systÃ¨me apparaÃ®tront ici</small>
          </div>
        {% endif %}
        <div class="mt-3">
          <a href="{{ url_for('tasks.tasks_dashboard') }}" class="btn btn-outline-primary btn-sm">ğŸ“Š Monitoring complet</a>
          <a href="{{ url_for('tasks.test_task_page') }}" class="btn btn-outline-secondary btn-sm">ğŸ§ª Test systÃ¨me</a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Informations systÃ¨me -->
<div class="row mt-4">
  <div class="col-md-12">
    <div class="alert alert-info">
      <h6>â„¹ï¸ Infrastructure opÃ©rationnelle</h6>
      <div class="row">
        <div class="col-md-4">
          <strong>ğŸ”§ Composants actifs :</strong>
          <ul class="mb-0">
            <li>Flask (API & Web UI)</li>
            <li>Celery (TÃ¢ches asynchrones)</li>
            <li>Redis (Broker de messages)</li>
            <li>SQLite (Base de donnÃ©es)</li>
          </ul>
        </div>
        <div class="col-md-4">
          <strong>ğŸ“Š Monitoring :</strong>
          <ul class="mb-0">
            <li><a href="http://localhost:5555" target="_blank">Flower (Celery)</a></li>
            <li><a href="http://localhost:9000" target="_blank">Graylog (Logs)</a></li>
          </ul>
        </div>
        <div class="col-md-4">
          <strong>ğŸ¯ Cibles de test :</strong>
          <ul class="mb-0">
            <li><a href="http://localhost:8080" target="_blank">DVWA</a></li>
            <li>RÃ©seau Docker (172.20.0.0/16)</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.border-dashed {
  border: 2px dashed #dee2e6 !important;
}
</style>

{% endblock %}
